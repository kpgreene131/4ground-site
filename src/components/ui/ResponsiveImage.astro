---
import SanityImage from './SanityImage.astro';
import type { SanityImage as SanityImageType } from '../../lib/sanity/api';

interface Props {
  image: SanityImageType | string;
  alt?: string;
  aspectRatio?: string;
  objectFit?: 'cover' | 'contain' | 'fill' | 'scale-down' | 'none';
  quality?: number;
  loading?: 'lazy' | 'eager';
  class?: string;
  style?: string;
  fallbackUrl?: string;
  
  // Responsive breakpoint sizes
  mobile?: number;
  tablet?: number;
  desktop?: number;
  large?: number;
}

const {
  image,
  alt,
  aspectRatio = '16/9',
  objectFit = 'cover',
  quality = 80,
  loading = 'lazy',
  class: className = '',
  style = '',
  fallbackUrl = '/images/placeholder.jpg',
  mobile = 400,
  tablet = 800,
  desktop = 1200,
  large = 1600
} = Astro.props;

// Determine if it's a Sanity image or regular URL
const isSanityImage = typeof image === 'object' && image?.asset;
const staticSrc = typeof image === 'string' ? image : fallbackUrl;

const responsiveSizes = [mobile, tablet, desktop, large];

// Combined styles
const combinedStyle = `
  aspect-ratio: ${aspectRatio};
  object-fit: ${objectFit};
  width: 100%;
  height: auto;
  ${style}
`;
---

{isSanityImage ? (
  <SanityImage
    image={image as SanityImageType}
    responsive={true}
    sizes={responsiveSizes}
    quality={quality}
    format="auto"
    loading={loading}
    class={`responsive-image ${className}`}
    style={combinedStyle}
    fallbackUrl={fallbackUrl}
  />
) : (
  <img
    src={staticSrc}
    alt={alt || ''}
    loading={loading}
    decoding="async"
    class={`responsive-image ${className}`}
    style={combinedStyle}
  />
)}

<style>
.responsive-image {
  display: block;
  border-radius: inherit;
  transition: transform 0.2s ease, opacity 0.3s ease;
}

.responsive-image:hover {
  transform: scale(1.02);
}

/* Skeleton loading state */
.responsive-image[src=""] {
  background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
</style>